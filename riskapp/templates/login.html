<!DOCTYPE html>
<html lang="tr" data-theme="light">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Giri≈ü</title>

  <!-- Ana tasarƒ±m dosyan (√∂zelliklerin kalsƒ±n) -->
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">

  <style>
    /* ========= RiskApp Login Template Look & Feel (kendi sayfana uygulandƒ±) ========= */
    :root{
      --primary: #2866bd;
      --background-light: #f0f2f4;
      --background-dark: #17191c;

      --slate-muted: #8B919D;
      --charcoal: #474B52;

      --login-max: 480px;
    }

    body{
      font-family: 'Space Grotesk', system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      min-height: 100dvh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding: 24px 16px;
      background: var(--background-light);
      color: var(--charcoal);
    }

    /* Kart g√∂lgesi: whisper-shadow */
    .whisper-shadow{
      box-shadow: 0 10px 40px -10px rgba(0, 0, 0, 0.08);
    }

    .login-wrap{
      width:100%;
      max-width: var(--login-max);
    }

    /* √úst logo */
    .brand{
      display:flex;
      align-items:center;
      justify-content:center;
      gap: 10px;
      margin-bottom: 18px;
    }
    .brand-badge{
      width: 42px;
      height: 42px;
      border-radius: 12px;
      background: var(--primary);
      display:flex;
      align-items:center;
      justify-content:center;
      color:#fff;
      font-weight: 900;
      letter-spacing: -0.02em;
      box-shadow: 0 14px 30px rgba(40,102,189,.18);
    }
    .brand-name{
      font-size: 24px;
      font-weight: 900;
      letter-spacing: -0.02em;
      color: var(--charcoal);
    }

    /* Login Card */
    .card{
      padding: clamp(20px, 3.6vw, 30px);
      border-radius: 16px;
      background: #fff;
      border: 1px solid rgba(2, 6, 23, 0.06);
      box-shadow: 0 22px 60px rgba(2,6,23,.08);
    }

    .card h1{
      margin: .2rem 0 .55rem;
      font-size: 32px;
      font-weight: 900;
      letter-spacing: -0.02em;
      color: var(--charcoal);
    }

    .desc{
      margin: 0 0 18px;
      color: var(--slate-muted);
      font-size: .95rem;
      line-height: 1.55;
    }

    /* Fields */
    .field{
      display:flex;
      flex-direction:column;
      gap: .45rem;
      margin-bottom: 16px;
    }

    label{
      font-size: .92rem;
      font-weight: 700;
      color: var(--charcoal);
      margin-left: 4px;
    }

    .input-group{
      display:flex;
      gap:.5rem;
      align-items:stretch;
    }
    .input-group .input{ flex:1; }

    /* Senin .input class'ƒ±nƒ± koruyoruz; burada login-tema g√∂r√ºn√ºm√º veriyoruz */
    .input{
      width: 100%;
      padding: 12px 14px;
      border-radius: 12px;
      border: 1px solid rgba(2,6,23,.10);
      background: rgba(248,250,252,.85);
      color: var(--charcoal);
      outline: none;
      transition: box-shadow .12s ease, border-color .12s ease, background .12s ease;
    }

    .input::placeholder{ color: rgba(71,75,82,.45); }

    .input:focus{
      background: #fff;
      border-color: rgba(40,102,189,.55);
      box-shadow: 0 0 0 4px rgba(40,102,189,.14);
    }

    .muted{ opacity:.95; color: var(--slate-muted); }
    .tiny{ font-size: .82rem; }
    .error{ color: #b00020; font-weight: 700; }

    .is-invalid{
      border-color: #b00020 !important;
      box-shadow: 0 0 0 .16rem rgba(176,0,32,.14) !important;
      background: #fff !important;
    }

    /* Yardƒ±m/hata metni hizasƒ± */
    .help-row{
      display:flex;
      gap: 10px;
      align-items:flex-start;
      justify-content:space-between;
      padding: 0 4px;
    }

    /* Buttons: senin .btn sƒ±nƒ±flarƒ±nƒ± silmeden, login temasƒ±na uyarlƒ±yoruz */
    .btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap: 8px;
      border-radius: 12px;
      padding: 10px 12px;
      font-weight: 800;
      border: 1px solid rgba(2,6,23,.10);
      background: rgba(2,6,23,.03);
      color: var(--charcoal);
      text-decoration:none;
      cursor:pointer;
      transition: background .12s ease, transform .12s ease, border-color .12s ease, box-shadow .12s ease;
    }
    .btn:hover{
      background: rgba(2,6,23,.05);
      text-decoration:none;
    }
    .btn:active{ transform: scale(.99); }

    .btn-primary{
      width: 100%;
      padding: 14px 12px;
      border-radius: 14px;
      border-color: rgba(40,102,189,.35);
      background: var(--primary);
      color:#fff;
      box-shadow: 0 14px 28px rgba(40,102,189,.20);
    }
    .btn-primary:hover{
      filter: brightness(.96);
    }

    .btn-ghost{
      background: transparent;
      border: 1px solid rgba(2,6,23,.10);
      color: var(--charcoal);
      padding: 10px 12px;
      border-radius: 12px;
      line-height: 1;
      white-space: nowrap;
    }
    .btn-ghost:hover{ background: rgba(2,6,23,.03); }

    /* Remember / forgot */
    .actions{
      margin-top: 14px;
      display:flex;
      flex-direction:column;
      gap: 14px;
    }
    .row-between{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
      flex-wrap:wrap;
    }

    .checkline{
      display:flex;
      align-items:center;
      gap: 10px;
      color: var(--slate-muted);
      font-weight: 650;
      cursor: pointer;
      user-select: none;
    }
    .checkline input[type="checkbox"]{
      width: 18px;
      height: 18px;
      border-radius: 6px;
      accent-color: var(--primary);
    }

    .link{
      color: var(--primary);
      font-weight: 800;
      text-decoration:none;
    }
    .link:hover{ text-decoration: underline; }

    /* Alt kayƒ±t satƒ±rƒ± */
    .divider{
      margin-top: 18px;
      padding-top: 18px;
      border-top: 1px solid rgba(2,6,23,.06);
      text-align:center;
      color: var(--slate-muted);
      font-weight: 650;
    }

    /* System status / meta */
    .meta{
      margin-top: 16px;
      display:flex;
      align-items:center;
      justify-content:center;
      gap: 18px;
      color: var(--slate-muted);
      font-size: 12px;
      font-weight: 650;
      flex-wrap: wrap;
    }
    .okdot{
      width: 9px; height: 9px;
      border-radius: 999px;
      background: #10b981;
      display:inline-block;
      margin-right: 6px;
    }

    /* Flash (senin feature) ‚Äî hafif modern g√∂r√ºns√ºn */
    .flash{
      margin: 10px 0 14px;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid rgba(2,6,23,.08);
      background: rgba(248,250,252,.75);
      color: var(--charcoal);
      font-weight: 700;
    }

    /* K√º√ß√ºk footer */
    .foot{
      margin-top: 12px;
      text-align:center;
      color: var(--slate-muted);
      font-size: .85rem;
      font-weight: 650;
    }

    /* Responsive */
    @media (max-width: 420px){
      .card{ padding: 18px; }
      .card h1{ font-size: 28px; }
    }
  </style>

  <!-- RiskApp login ≈üablonundaki font (kendi projene ekliyoruz) -->
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>
</head>

<body>
  <main class="login-wrap">

    <!-- Brand -->
    <div class="brand" aria-label="RiskApp">
      <div class="brand-badge" aria-hidden="true">üõ°Ô∏è</div>
      <div class="brand-name">RiskApp</div>
    </div>

    <!-- Login Card -->
    <section class="card whisper-shadow" role="form" aria-labelledby="loginTitle">
      <header style="margin-bottom: 18px;">
        <h1 id="loginTitle">Giri≈ü</h1>
        <p class="desc">L√ºtfen kurumsal e-posta adresinizle giri≈ü yapƒ±n.</p>
      </header>

      {# Flash mesajlarƒ± (√∂zelliƒüin aynen duruyor) #}
      {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
          {% for cat, msg in messages %}
            <div class="flash {{cat}}" role="alert" aria-live="polite">{{ msg }}</div>
          {% endfor %}
        {% endif %}
      {% endwith %}

      <form id="loginForm" method="post" novalidate>
        {% if csrf_token is defined %}{{ csrf_token() }}{% endif %}

        <!-- E-posta -->
        <div class="field">
          <label for="email">Kurumsal E-posta</label>
          <input
            class="input"
            id="email"
            type="email"
            name="email"
            placeholder="isim@sirket.com"
            value="{{ (email or '')|trim|e }}"
            required
            inputmode="email"
            autocomplete="email"
            maxlength="120"
            aria-describedby="emailHelp emailErr"
            aria-invalid="false"
          >
          <div class="help-row">
            <small id="emailHelp" class="muted tiny">Kurumsal e-posta adresinizi giriniz.</small>
            <small id="emailErr" class="tiny error" hidden>E-posta formatƒ± hatalƒ±.</small>
          </div>
        </div>

        <!-- ≈ûifre -->
        <div class="field">
          <label for="password">≈ûifre</label>
          <div class="input-group">
            <input
              class="input"
              id="password"
              type="password"
              name="password"
              placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
              required
              minlength="8"
              maxlength="128"
              autocomplete="current-password"
              pattern="^(?=.*[A-Za-z])(?=.*\d).{8,128}$"
              title="En az bir harf ve bir rakam i√ßermelidir."
              aria-describedby="pwdHelp pwdErr"
              aria-invalid="false"
            >
            <button class="btn-ghost" type="button" id="togglePwd"
                    aria-controls="password" aria-pressed="false"
                    aria-label="≈ûifreyi g√∂ster/gizle">
              G√∂ster
            </button>
          </div>
          <div class="help-row">
            <small id="pwdHelp" class="muted tiny">En az 8 karakter olmalƒ±dƒ±r.</small>
            <small id="pwdErr" class="tiny error" hidden>≈ûifre kurala uymuyor.</small>
          </div>
        </div>

        <!-- Referans Kodu (opsiyonel) -->
        <div class="field">
          <label for="ref_code">Referans Kodu <span class="muted tiny">(Opsiyonel)</span></label>
          <input
            class="input"
            id="ref_code"
            type="text"
            name="ref_code"
            placeholder="Opsiyonel"
            value="{{ (ref_code or '')|trim|e }}"
            inputmode="text"
            maxlength="32"
            autocomplete="one-time-code"
            aria-describedby="refHelp"
          >
          <div class="help-row">
            <small id="refHelp" class="muted tiny">Varsa referans kodunuzu ekleyin.</small>
            <span></span>
          </div>
        </div>

        <!-- Remember & Forgot -->
        <div class="row-between" style="padding: 4px 2px 0;">
          <label class="checkline" for="remember">
            <input id="remember" name="remember" type="checkbox" {% if remember %}checked{% endif %}>
            <span>Beni hatƒ±rla</span>
          </label>

          <a class="link" href="{{ url_for('forgot_password') }}">≈ûifremi unuttum</a>
        </div>

        <!-- Primary Action -->
        <div class="actions">
          <button class="btn btn-primary" id="submitBtn" type="submit">Giri≈ü yap</button>
        </div>

        <!-- Footer Links -->
        <div class="divider">
          Hesabƒ±nƒ±z yok mu?
          <a class="link" href="{{ url_for('setup_step1') }}">Kayƒ±t ol</a>
        </div>
      </form>

      <p class="foot">Giri≈üte sorun mu var? <a class="link" href="mailto:support@ornek.com">support@ornek.com</a></p>
    </section>

    <!-- System Status / Meta Info -->
    <div class="meta">
      <div><span class="okdot"></span> T√ºm sistemler √ßalƒ±≈üƒ±yor</div>
      <a class="link" href="#">Destek</a>
      <a class="link" href="#">Gizlilik Politikasƒ±</a>
    </div>

  </main>

  <script>
  (function () {
    const form = document.getElementById('loginForm');
    const btn = document.getElementById('submitBtn');
    const email = document.getElementById('email');
    const pwd = document.getElementById('password');
    const ref = document.getElementById('ref_code');
    const togglePwd = document.getElementById('togglePwd');

    const emailErr = document.getElementById('emailErr');
    const pwdErr = document.getElementById('pwdErr');

    // Metin temizleme ‚Äî emoji/bo≈üluk sil
    const stripEmojis = (s) => s.replace(/\p{Extended_Pictographic}/gu, '');
    const cleanEmail = (v) => stripEmojis(v).replace(/\s+/g,'');
    const cleanPassword = (v) => stripEmojis(v);

    // caret pozisyonunu koruyarak alanƒ± g√ºncelle
    function replaceKeepingCaret(input, next){
      const before = input.value;
      if (before === next) return;
      const delta = before.length - next.length;
      const pos = input.selectionStart;
      input.value = next;
      if (typeof pos === 'number') input.setSelectionRange(pos - delta, pos - delta);
    }

    // E-posta doƒürulama
    email.addEventListener('input', () => {
      replaceKeepingCaret(email, cleanEmail(email.value));
      const valid = email.checkValidity();
      email.classList.toggle('is-invalid', !valid);
      email.setAttribute('aria-invalid', String(!valid));
      emailErr.hidden = valid;
    });

    // ≈ûifre doƒürulama
    pwd.addEventListener('input', () => {
      replaceKeepingCaret(pwd, cleanPassword(pwd.value));
      const valid = pwd.checkValidity();
      pwd.classList.toggle('is-invalid', !valid);
      pwd.setAttribute('aria-invalid', String(!valid));
      pwdErr.hidden = valid;
    });

    // Ref code: otomatik UPPERCASE + bo≈üluklarƒ± kaldƒ±r
    if (ref){
      ref.addEventListener('input', () => {
        const next = ref.value.toUpperCase().replace(/\s+/g,'');
        replaceKeepingCaret(ref, next);
      });
    }

    // ≈ûifre g√∂ster/gizle
    if (togglePwd){
      togglePwd.addEventListener('click', () => {
        const isText = pwd.type === 'text';
        pwd.type = isText ? 'password' : 'text';
        togglePwd.textContent = isText ? 'G√∂ster' : 'Gizle';
        togglePwd.setAttribute('aria-pressed', String(!isText));
        pwd.focus();
      });
    }

    // Submit ‚Äî √ßift tƒ±k kilidi + alan bazlƒ± hata odaklama
    form.addEventListener('submit', (e) => {
      const allValid = form.checkValidity();
      if (!allValid){
        e.preventDefault();
        [email, pwd].forEach(el => {
          const valid = el.checkValidity();
          el.classList.toggle('is-invalid', !valid);
          el.setAttribute('aria-invalid', String(!valid));
          (el.id === 'email' ? emailErr : pwdErr).hidden = valid;
        });
        const firstInvalid = form.querySelector('.is-invalid');
        (firstInvalid || email).focus();
        return;
      }
      btn.disabled = true;
      btn.textContent = 'G√∂nderiliyor...';
    });

    // ƒ∞lk odak: e-posta; doluysa ≈üifre
    if (!email.value) email.focus(); else pwd.focus();
  })();
  </script>
</body>
</html>

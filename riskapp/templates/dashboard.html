{% extends "base.html" %}
{% block title %}Dashboard Â· Risk YÃ¶netim{% endblock %}
{% block content %}
<div class="grid grid-2">
  <!-- Sol: Genel GÃ¶rÃ¼nÃ¼m -->
  <div class="card">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <h3>Genel GÃ¶rÃ¼nÃ¼m</h3>
      <div style="display:flex;gap:8px;flex-wrap:wrap">
        <a class="btn" href="{{ url_for('risk_select') }}">Riskler</a>
        {% if session.get('role') == 'admin' %}
          <a class="btn" href="{{ url_for('categories_index') }}">Kategori YÃ¶netimi</a>
        {% endif %}
        <a class="btn btn-primary" href="{{ url_for('risk_new') }}">+ Yeni Risk</a>
      </div>
    </div>

    <table class="table">
      <thead>
        <tr>
          <th>BaÅŸlÄ±k</th>
          <th>Kategori</th>
          <th>Skor</th>
          <th>Durum</th>
        </tr>
      </thead>
      <tbody>
        {% for r in risks[:8] %}
        <tr>
          <td><a href="{{ url_for('risk_detail', risk_id=r.id) }}">{{ r.title }}</a></td>
          <td>{{ r.category or "-" }}</td>
          <td>
            {% if r.score() %}
              {% set sc = r.score() %}
              <span class="badge {% if sc<10 %}score-low{% elif sc<16 %}score-mid{% else %}score-high{% endif %}">
                {{ '%.2f'|format(sc) }}
              </span>
            {% else %}
              <span class="badge">â€”</span>
            {% endif %}
          </td>
          <td>{{ r.status }}</td>
        </tr>
        {% else %}
        <tr><td colspan="4" class="small">HenÃ¼z risk bulunmuyor. â€œ+ Yeni Riskâ€ ile ekleyin.</td></tr>
        {% endfor %}
      </tbody>
    </table>
    <div class="small">Son gÃ¼ncellenen 8 risk gÃ¶steriliyor. TÃ¼mÃ¼ iÃ§in â€œRisklerâ€ sayfasÄ±na gidin.</div>
  </div>

  <!-- SaÄŸ: Risk Matrisi -->
  <div class="card">
    <h3>Risk Matrisi (OlasÄ±lÄ±k Ã— Åiddet)</h3>

    <div class="matrix" role="grid" aria-label="OlasÄ±lÄ±k Ã— Åiddet matrisi">
      {# Åiddet satÄ±rlarÄ± 5'ten 1'e, olasÄ±lÄ±k sÃ¼tunlarÄ± 1'den 5'e #}
      {% for s in range(5,0,-1) %}
        {% for p in range(1,6) %}
          {% set count = matrix[5-s][p-1] %}
          {% set score = p * s %}
          <div class="cell"
               title="P={{p}}, S={{s}} Â· Skor {{score}} Â· {{count}} adet">
            <div class="cell-score">{{ score }}</div>
            <div class="cell-count small">{{ count }} adet</div>
          </div>
        {% endfor %}
      {% endfor %}
    </div>

    <div class="small" style="margin-top:6px;">
      Ãœstte skor, altta o hÃ¼credeki risk adedi gÃ¶sterilir.
    </div>

    <div class="small" style="margin-top:8px; display:flex; gap:8px; align-items:center;">
      <span class="badge score-low">DÃ¼ÅŸÃ¼k</span>
      <span class="badge score-mid">Orta</span>
      <span class="badge score-high">YÃ¼ksek</span>
    </div>
  </div>
</div>

<!-- Alt: HÄ±zlÄ± Ä°ÅŸlemler -->
<div class="card" style="margin-top:12px">
  <h3>HÄ±zlÄ± Ä°ÅŸlemler</h3>
  <div style="display:flex;flex-wrap:wrap;gap:8px">
    <a class="btn" href="{{ url_for('risk_identify') }}">ğŸ“‹ Risk TanÄ±mla</a>
    {% if session.get('role') == 'admin' %}
      <a class="btn" href="{{ url_for('categories_index') }}">ğŸ—‚ï¸ Kategori YÃ¶netimi</a>
      <a class="btn" href="{{ url_for('import_suggestions') }}">â¬†ï¸ CSV Ä°Ã§e Aktar</a>
    {% endif %}
    <a class="btn" href="{{ url_for('risks_export_csv') }}">â¬‡ï¸ CSV DÄ±ÅŸa Aktar</a>
    <a class="btn" href="{{ url_for('settings_account') }}">âš™ï¸ Hesap AyarlarÄ±</a>
    <a class="btn" href="{{ url_for('settings_project') }}">ğŸ·ï¸ Proje Bilgileri</a>
  </div>
</div>
{% endblock %}

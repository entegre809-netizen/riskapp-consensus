{% extends "base.html" %}
{% block title %}Risk Şablonu · {{ s.risk_title or s.text }}{% endblock %}

{% block content %}

<style>
  .rt-card{
    max-width: 920px;
    margin: 0 auto;
  }
  .rt-header{
    display:flex;
    justify-content:space-between;
    gap:1rem;
    align-items:flex-start;
    margin-bottom:1rem;
  }
  .rt-title{
    font-size:1.25rem;
    font-weight:700;
    letter-spacing:.01em;
  }
  .rt-badge{
    display:inline-flex;
    align-items:center;
    padding:.25rem .6rem;
    border-radius:999px;
    border:1px solid color-mix(in oklab, var(--line) 80%, transparent);
    font-size:.8rem;
    color:var(--muted);
  }
  .rt-grid{
    display:grid;
    grid-template-columns:minmax(0, 1.1fr) minmax(0, 1.4fr);
    gap:1rem 1.4rem;
  }
  @media (max-width: 900px){
    .rt-grid{ grid-template-columns:1fr; }
  }
  .rt-label{
    font-size:.8rem;
    text-transform:uppercase;
    letter-spacing:.08em;
    color:var(--muted);
    font-weight:700;
    margin-bottom:.25rem;
  }
  .rt-box{
    border-radius:14px;
    border:1px solid color-mix(in oklab, var(--line) 82%, transparent);
    padding:.75rem .9rem;
    background: color-mix(in oklab, var(--bg-soft) 97%, transparent);
    font-size:.95rem;
    white-space:pre-wrap;
  }
  .rt-meta{
    display:grid;
    grid-template-columns:repeat(3, minmax(0,1fr));
    gap:.75rem;
    margin-top:.5rem;
  }
  @media (max-width: 720px){
    .rt-meta{ grid-template-columns:repeat(2, minmax(0,1fr)); }
  }
  .rt-kpi{
    border-radius:12px;
    border:1px solid color-mix(in oklab, var(--line) 80%, transparent);
    padding:.55rem .7rem;
    font-size:.85rem;
  }
  .rt-kpi strong{
    display:block;
    font-size:.9rem;
  }
</style>

<div class="card rt-card">
  <div class="rt-header">
    <div>
      <div class="rt-label">Risk Şablonu</div>
      <div class="rt-title">
        {{ s.risk_title or s.text }}
      </div>
      <div style="margin-top:.35rem; font-size:.9rem; color:var(--muted);">
        Kategori:
        <strong>{{ s.category or 'Genel / Kategorisiz' }}</strong>
      </div>
    </div>
    <div>
      {% if s.risk_code %}
        <div class="rt-badge">Kod: {{ s.risk_code }}</div>
      {% endif %}
    </div>
  </div>

  <div class="rt-grid">
    <div>
      <div class="rt-label">Risk Faktörü</div>
      <div class="rt-box">
        {{ s.risk_desc or s.text }}
      </div>
    </div>
    <div>
      <div class="rt-label">Önerilen Önlemler</div>
      <div class="rt-box">
        {% if s.mitigation_hint %}
          {{ s.mitigation_hint }}
        {% else %}
          Henüz tanımlı önerilen önlem yok. Bu şablondan risk üretirken detaylandırabilirsiniz.
        {% endif %}
      </div>
    </div>
  </div>

  <div class="rt-meta" style="margin-top:1.1rem;">
    <div class="rt-kpi">
      <span class="rt-label" style="margin-bottom:.1rem;">Vars. Olasılık (P)</span>
      <strong>{{ s.default_prob if s.default_prob is not none else '—' }}</strong>
    </div>
    <div class="rt-kpi">
      <span class="rt-label" style="margin-bottom:.1rem;">Vars. Şiddet (S)</span>
      <strong>{{ s.default_sev if s.default_sev is not none else '—' }}</strong>
    </div>
    <div class="rt-kpi">
      <span class="rt-label" style="margin-bottom:.1rem;">Vars. Skor (P × S)</span>
      <strong>
  {% if s.default_prob is not none and s.default_sev is not none %}
    {{ s.default_prob * s.default_sev }}
  {% else %}
    —
  {% endif %}
</strong>

    </div>
  </div>

  <div style="margin-top:1.4rem; display:flex; justify-content:flex-end; gap:.5rem;">
    <a href="{{ url_for('risk_identify') }}" class="btn btn-ghost">Tanımlı risk listesine dön</a>
  </div>
</div>

{% endblock %}
